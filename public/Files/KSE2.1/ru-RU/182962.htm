<!DOCTYPE html>
<html lang="ru-RU" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="maximum-scale=1.0">
    <title> Поиск и устранение неисправностей </title>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-MPK6ZG');</script>
	<!-- End Google Tag Manager -->
    <script type="text/javascript" src="../langs.js"></script>
    <script type="text/javascript">
        !function ( w, d ) {
            var scriptsPath="/localization/";
            if(w.location.pathname.match(/title\.htm$/)){scriptsPath="./js/"}d.writeln("\x3Cscript type='text/javascript' src='"+scriptsPath+d.documentElement.lang+".js'>\x3C/script>");
        }( window, document );
    </script>	
    <script type="text/javascript" src="toc.js"></script>
    
    <script type="text/javascript" src="aiconverter_result.js"></script>
    <link rel="stylesheet" type='text/css' href="typography.css">
    <link rel="stylesheet" type='text/css' href="styles.css">
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.png" type="image/png">

            <!--[if lte IE 9]>
                <link rel="stylesheet" type="text/css" href="bootstrap.css">
            <![endif]-->
            <!--[if lte IE 8]>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"></script>
            <![endif]-->
            </head>

<body id="who-content" class="no-js">
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MPK6ZG" style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->
	<noscript class="no-js__message">
	<a href="https://support.microsoft.com/en-us/kb/3135465" class="no-js__link">Пожалуйста, включите JavaScript в вашем браузере!</a>
	</noscript>
	<div class="cont">
	<h1 id="t234539" class="heading1">Поиск и устранение неисправностей</h1>
<p class="bodytext">В этом разделе представлена информация, полезная при решении проблем, которые могут возникнуть при использовании Kaspersky Scan Engine.</p>
<p class="bodytext">Если вы столкнулись с проблемой, не упомянутой в этом разделе, включите логирование, повторите действия, которые предшествовали проблеме, а затем отправьте журналы и файлы конфигурации вашему техническому менеджеру по работе с клиентами.</p>
<p class="introheading">Проблема: Kaspersky Scan Engine не запускается после перезагрузки системы и не может быть запущен с помощью systemctl</p>
<p class="bodytext">Причина этой проблемы может заключаться в том, что директория <code class="programcharacter">/opt/</code> находится на смонтированном устройстве. Когда Kaspersky Scan Engine инициализируется после перезагрузки, устройство еще не смонтировано, и операционная система не может найти файлы модулей systemd для Kaspersky Scan Engine.</p>
<p class="bodytext">Чтобы решить эту проблему, попробуйте следующие действия:</p>
<ol class="listnumber1"><li class="listnumber1">Отключите службы Kaspersky Scan Engine:<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">systemctl disable klScanEngineUI</code></li><li class="listbullet2">Для режима HTTP:<p class="listcontinue2"><code class="programcharacter">systemctl disable kavhttpd</code></p> </li><li class="listbullet2">Для режима ICAP:<p class="listcontinue2"><code class="programcharacter">systemctl disable kavicapd</code></p> </li></ul></li><li class="listnumber1">Удалите символьные ссылки на файлы конфигурации Kaspersky Scan Engine.<p class="listcontinue1"><code class="programcharacter">rm /etc/klScanEngineUI.xml /etc/kavhttpd.xml /etc/kavicapd.xml</code></p> </li><li class="listnumber1">Скопируйте файлы модуля Kaspersky Scan Engine в <code class="programcharacter">/etc/systemd/system/</code>:<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">cp /opt/kaspersky/ScanEngine/etc/klScanEngineUI.service /etc/systemd/system/klScanEngineUI.service</code></li><li class="listbullet2">Для режима HTTP:<p class="listcontinue2"><code class="programcharacter">cp /opt/kaspersky/ScanEngine/etc/kavhttpd.service /etc/systemd/system/kavhttpd.service</code></p> </li><li class="listbullet2">Для режима ICAP:<p class="listcontinue2"><code class="programcharacter">cp /opt/kaspersky/ScanEngine/etc/kavicapd.service /etc/systemd/system/kavicapd.service</code></p> </li></ul></li><li class="listnumber1">Скопируйте файлы конфигурации Kaspersky Scan Engine в /etc/:<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">cp /opt/kaspersky/ScanEngine/etc/klScanEngineUI.xml /etc/klScanEngineUI.xml</code></li><li class="listbullet2">Для режима HTTP:<p class="listcontinue2"><code class="programcharacter">cp /opt/kaspersky/ScanEngine/etc/kavhttpd.xml /etc/kavhttpd.xml</code></p> </li><li class="listbullet2">Для режима ICAP:<p class="listcontinue2"><code class="programcharacter">cp /opt/kaspersky/ScanEngine/etc/kavicapd.xml /etc/kavicapd.xml</code></p> </li></ul></li><li class="listnumber1">Перезагрузите systemd:<p class="listcontinue1"><code class="programcharacter">systemctl daemon-reload</code></p> </li><li class="listnumber1">Включите запуск служб Kaspersky Scan Engine при загрузке системы:<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">systemctl enable klScanEngineUI</code></li><li class="listbullet2">Для режима HTTP:<p class="listcontinue2"><code class="programcharacter">systemctl enable kavhttpd</code></p> </li><li class="listbullet2">Для режима ICAP:<p class="listcontinue2"><code class="programcharacter">systemctl enable kavicapd</code></p> </li></ul></li><li class="listnumber1">Запустите службы Kaspersky Scan Engine:<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">service klScanEngineUI start</code></li><li class="listbullet2">Для режима HTTP:<p class="listcontinue2"><code class="programcharacter">service kavhttpd start</code></p> </li><li class="listbullet2">Для режима ICAP:<p class="listcontinue2"><code class="programcharacter">service kavicapd start</code></p> </li></ul></li></ol><p class="introheading">Проблема: Kaspersky Scan Engine не запускается и не печатает журналы</p>
<p class="bodytext">Проблема может заключаться в том, что Kaspersky Scan Engine не может найти <code class="programcharacter">klScanEngineUI.xml</code>, либо файл поврежден и Kaspersky Scan Engine не может его прочитать. </p>
<ul class="listbullet1"><li class="listbullet1">Чтобы найти решение этой проблемы, проверьте файлы журналов, которые создаются в поддиректории <code class="programcharacter">/tmp/</code> директории установки Kaspersky Scan Engine.</li></ul><p class="introheading">Проблема: произошла ошибка при загрузке данных через Kaspersky Scan Engine GUI (панель управления или страница результатов проверки)</p>
<p class="bodytext">Причина возникновения проблемы – Kaspersky Scan Engine не может подключиться к базе данных <code class="programcharacter">kavebase</code> или прочитать из нее данные.</p>
<p class="bodytext">Чтобы решить эту проблему, попробуйте следующие действия:</p>
<ul class="listbullet1"><li class="listbullet1">Проверьте, запущен ли экземпляр PostgreSQL.</li><li class="listbullet1">Проверьте, доступен ли экземпляр PostgreSQL из вашего экземпляра Kaspersky Scan Engine.</li><li class="listbullet1">Проверьте, сохраняется ли база данных <code class="programcharacter">kavebase</code> в экземпляре PostgreSQL.<p class="listcontinue1">Если нет, создайте базу данных <code class="programcharacter">kavebase</code>, как описано в разделе &quot;<a id="h181517" class="englishcrossreferencetemplate" href="180652.htm" target="_self">Ручная установка (Linux)</a>&quot;.</p> </li><li class="listbullet1">Проверьте, сохраняется ли пользователь базы данных <code class="programcharacter">scanengine</code> в экземпляре PostgreSQL.<p class="listcontinue1">Если нет, создайте пользователя базы данных <code class="programcharacter">scanengine</code>, как описано в разделе &quot;<a id="h181517_2" class="englishcrossreferencetemplate" href="180652.htm" target="_self">Ручная установка (Linux)</a>&quot;.</p> </li></ul><p class="introheading">Проблема: Kaspersky Scan Engine GUI не отображается в браузере</p>
<p class="bodytext">Чтобы решить эту проблему, попробуйте следующие действия:</p>
<ul class="listbullet1"><li class="listbullet1">Убедитесь, что запущены экземпляр Kaspersky Scan Engine и служба klScanEngineUI.</li><li class="listbullet1">Убедитесь, что вы используете <a id="h193112" class="englishcrossreferencetemplate" href="184795.htm" target="_self">поддерживаемый браузер</a>.</li><li class="listbullet1">Убедитесь, что файл конфигурации klScanEngineUI.xml содержит следующее:<ul class="listbullet2"><li class="listbullet2">В поле <code class="programcharacter">ServerSettings &gt; EnableUI</code> указано значение <code class="programcharacter">true</code>.</li><li class="listbullet2">Элемент <code class="programcharacter">ServerSettings &gt; ConnectionString</code> содержит один из следующих IP-адресов:<ul class="listbullet3"><li class="listbullet3"><code class="programcharacter">127.0.0.1</code><p class="listcontinue3">В этом случае Kaspersky Scan Engine GUI доступен с того же компьютера, на котором установлен Kaspersky Scan Engine.</p>
</li><li class="listbullet3">Сетевой IP-адрес<p class="listcontinue3">В этом случае Kaspersky Scan Engine GUI доступен по сети.</p> <p class="listcontinue3">Убедитесь, что брандмауэр не блокирует доступ к компьютеру, на котором установлен Kaspersky Scan Engine.</p> </li></ul></li></ul></li></ul><p class="introheading">Проблема: ошибка ненадежного соединения при подключении к Kaspersky Scan Engine GUI</p>
<p class="bodytext">SSL-сертификаты, сгенерированные при установке Kaspersky Scan Engine, являются самозаверяющими, поэтому используемый вами браузер сообщает о ненадежном соединении.</p>
<p class="bodytext">Чтобы решить эту проблему, попробуйте следующее:</p>
<ul class="listbullet1"><li class="listbullet1">Рекомендуется: <a id="h182985" class="englishcrossreferencetemplate" href="182983.htm" target="_self">используйте другие сертификаты, которым доверяет</a> ваша инфраструктура.</li><li class="listbullet1">Если вы не можете использовать другие сертификаты, можно <a id="h182986" class="englishcrossreferencetemplate" href="182984.htm" target="_self">добавить изначально сгенерированные сертификаты в качестве доверенных</a> для вашего браузера или операционной системы.</li></ul><p class="introheading">Проблема: произошла ошибка при сохранении параметров в Kaspersky Scan Engine GUI</p>
<ul class="listbullet1"><li class="listbullet1">Проверьте правильность указанных вами параметров.</li><li class="listbullet1">Проверьте статус службы <code class="programcharacter">kavhttpd</code> или <code class="programcharacter">kavicapd</code>, выполнив одну из команд:<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">service kavhttpd status</code></li><li class="listbullet2"><code class="programcharacter">service kavicapd status</code></li></ul></li></ul><p class="introheading">Проблема: произошла ошибка при удалении базы данных во время деинсталляции, к базе данных kavebase обращаются другие пользователи</p>
<p class="bodytext">Возможная причина: кто-то еще подключен к базе данных <code class="programcharacter">kavebase</code> (например, с помощью pgAdmin).</p>
<p class="bodytext">Решение: выполните следующий запрос к <code class="programcharacter">kavebase</code>:</p>
<table class="tableintopic" width="1131" cellpadding="2" cellspacing="0" border="0" style="border-collapse:collapse" bgcolor="#E5F1FB">
<tr align="left" valign="top">
<td bgcolor="#E5F1FB" width="1131"><p class="program">SELECT *, pg_terminate_backend(pid)</p>
<p class="program">FROM pg_stat_activity</p>
<p class="program">WHERE pid &lt;&gt; pg_backend_pid()</p>
<p class="program">AND datname = &#39;kavebase&#39;;</p>
</td>
</tr>

</table>
<p class="introheading">Проблема: psql не распознается как внутренняя или внешняя команда</p>
<p class="bodytext">Эта проблема может возникнуть в Windows. Чтобы решить эту проблему, добавьте директорию bin PostgreSQL в переменную среды PATH.</p>
<p class="procedureheading">В Windows выполните следующие действия.</p>
<ol class="listnumber1"><li class="listnumber1">Перейдите в  <span class="boldcharacter">Control Panel</span> -&gt; <span class="boldcharacter">System and Security</span> -&gt; <span class="boldcharacter">System</span> -&gt; <span class="boldcharacter">Advanced system settings</span> -&gt; <span class="boldcharacter">Environment variables...</span>.<p class="listcontinue1">Откроется диалоговое окно <span class="boldcharacter">Environment variables</span>.</p> </li><li class="listnumber1">В списке системных переменных (нижняя половина диалогового окна) выберите <span class="boldcharacter">Path</span> и нажмите кнопку <span class="boldcharacter">Edit</span>.</li><li class="listnumber1">Нажмите кнопку <span class="boldcharacter">New</span> и введите путь к директории bin PostgreSQL (например, <code class="programcharacter">C:\Program Files\PostgreSQL\13\bin</code>).</li><li class="listnumber1">Сохраните изменения, нажав кнопку <span class="boldcharacter">ОК</span> во всех диалоговых окнах.</li></ol><p class="introheading">Проблема: для аутентификации SCRAM требуется libpq версии 10 или выше</p>
<p class="bodytext">Эта проблема может возникнуть при установке Kaspersky Scan Engine, если вы используете PostgreSQL 13 и значение <code class="programcharacter">password_encryption</code> отличается от <code class="programcharacter">md5</code>.</p>
<p class="procedureheading">Чтобы решить эту проблему, сделайте следующее.</p>
<ol class="listnumber1"><li class="listnumber1">В файле конфигурации <code class="programcharacter">postgresql.conf</code> установите для параметра <code class="programcharacter">password_encryption</code> значение <code class="programcharacter">md5</code>. <p class="listcontinue1">Сохраните изменения.</p> </li><li class="listnumber1">Перезагрузите PostgreSQL:<table class="tableintopic" width="1131" cellpadding="2" cellspacing="0" border="0" style="border-collapse:collapse" bgcolor="#E5F1FB">
<tr align="left" valign="top">
<td bgcolor="#E5F1FB" width="1131"><p class="program">systemctl restart postgresql-13</p>
</td>
</tr>

</table> </li><li class="listnumber1">Обновите пароль пользователя базы данных с правами администратора (например, пользователя <code class="programcharacter">postgres</code>), который будет использоваться при установке Kaspersky Scan Engine:<table class="tableintopic" width="1131" cellpadding="2" cellspacing="0" border="0" style="border-collapse:collapse" bgcolor="#E5F1FB">
<tr align="left" valign="top">
<td bgcolor="#E5F1FB" width="1131"><p class="program">alter user postgres with password &#39;%PASSWORD%&#39;;</p>
</td>
</tr>

</table> </li><li class="listnumber1">Убедитесь, что метод аутентификации установлен на <code class="programcharacter">md5</code> <a id="h198591" class="englishcrossreferencetemplate" href="192975.htm" target="_self">в файле pg_hba.conf</a>.</li><li class="listnumber1">Повторите установку Kaspersky Scan Engine.</li></ol><p class="introheading">Проблема: в Kaspersky Scan Engine GUI не отображаются события (панель управления или страница результатов проверки)</p>
<p class="bodytext">Эта проблема может возникнуть, если база данных <code class="programcharacter">kavebase</code> повреждена.</p>
<p class="procedureheading">Чтобы решить эту проблему, сделайте следующее.</p>
<ol class="listnumber1"><li class="listnumber1">Остановите следующие процессы:<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">klScanEngineUI</code></li><li class="listbullet2"><code class="programcharacter">kavhttpd</code> (режим HTTP) или <code class="programcharacter">kavicapd</code> (режим ICAP)</li></ul></li><li class="listnumber1">Удалите базу данных kavebase, выполнив следующую команду:<p class="listcontinue1"><code class="programcharacter">DROP DATABASE kavebase;</code></p> </li><li class="listnumber1">Создайте новую базу данных <code class="programcharacter">kavebase</code>, выполнив следующую команду:<p class="listcontinue1"><code class="programcharacter">CREATE DATABASE kavebase OWNER %owner%;</code></p> <p class="listcontinue1">Здесь <code class="programcharacter">%owner%</code> – это пользователь, созданный для работы с <code class="programcharacter">kavebase</code> при установке Kaspersky Scan Engine.</p> </li><li class="listnumber1">Импортируйте файл <code class="programcharacter">tables.sql</code> из директории <code class="programcharacter">%service_dir%/samples</code>, выполнив следующую команду:<p class="listcontinue1"><code class="programcharacter">psql -d kavebase -a -f tables.sql</code></p> </li><li class="listnumber1">Перезапустите процессы, которые вы остановили на шаге 1.</li></ol><p class="warningbody">После этой операции пароль <code class="programcharacter">admin</code> для Kaspersky Scan Engine GUI будет восстановлен до значения по умолчанию, а все предыдущие события будут удалены.</p>


	<a href="#" class="bt-home">В начало страницы</a>
	</div>
</body>

</html>
