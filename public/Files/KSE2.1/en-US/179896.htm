<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="description" content=""/>
    <meta name="viewport" content="maximum-scale=1.0" />
    <title> Configuring logging in ICAP mode </title>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-MPK6ZG');</script>
	<!-- End Google Tag Manager -->
    <script type="text/javascript" src="../langs.js"></script>
    <script type="text/javascript">
        !function ( w, d ) {
            var scriptsPath="/localization/";
            if(w.location.pathname.match(/title\.htm$/)){scriptsPath="./js/"}d.writeln("\x3Cscript type='text/javascript' src='"+scriptsPath+d.documentElement.lang+".js'>\x3C/script>");
        }( window, document );
    </script>	
    <script type="text/javascript" src="toc.js"></script>
    
    <script type="text/javascript" src="aiconverter_result.js"></script>
    <link rel="stylesheet" type='text/css' href="typography.css"/>
    <link rel="stylesheet" type='text/css' href="styles.css"/>
    <link rel="shortcut icon" href="favicon.ico"/>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
    <link rel="icon" href="favicon.png" type="image/png"/>

            <!--[if lte IE 9]>
                <link rel="stylesheet" type="text/css" href="bootstrap.css">
            <![endif]-->
            <!--[if lte IE 8]>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"></script>
            <![endif]-->
            </head>

<body id="who-content" class="no-js">
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MPK6ZG" style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->
	<noscript class="no-js__message">
	<a href="https://support.microsoft.com/en-us/kb/3135465" class="no-js__link">Please enable JavaScript in your browser!</a>
	</noscript>
	<div class="cont">
	<h3 id="t234306" class="heading3">Configuring logging in ICAP mode</h3>
<p class="bodytext">This section explains how to manually configure logging in ICAP mode without using Kaspersky Scan Engine GUI.</p>
<p class="bodytext">In ICAP mode, Kaspersky Scan Engine can log its activity. Logging settings are specified in the icapdkavlog.conf configuration file (hereinafter referred to as the logging configuration file), located in the <code class="programcharacter">/opt/kaspersky/ScanEngine/bin</code> directory. </p>
<p class="bodytext">You can change the logging settings after the <code class="programcharacter">kavicapd</code> service is started. </p>
<p class="bodytext">See also the detailed instructions on <a id="h180103" class="englishcrossreferencetemplate" href="179928.htm" target="_self">enabling logging</a>.</p>
<p class="introheading">Elements of the logging configuration file</p>
<p class="bodytext"><code class="programcharacter">Logging</code>&#8212;The root element of the file. This element has two child elements: <code class="programcharacter">DebugLogging</code> and <code class="programcharacter">SyslogLogging</code>.</p>
<p class="introheading">DebugLogging Section</p>
<ul class="listbullet1"><li class="listbullet1"><code class="programcharacter">DebugLogging</code> is a parent element that contains setting for logs that are written directly to the log files and can help identify service malfunctions.<p class="listcontinue1">This element has the following child elements.</p>
</li><li class="listbullet1"><code class="programcharacter">Level</code>&#8212;Specifies the logging level. <p class="listcontinue1">Possible values:</p>
<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">none</code> or <code class="programcharacter">non</code> <p class="listcontinue2">Logging is disabled.</p>
</li><li class="listbullet2"><code class="programcharacter">debug</code> or <code class="programcharacter">dbg</code><p class="listcontinue2">Debug level. At this logging level, Kaspersky Scan Engine logs information that can help identify problems, such as changes in the state of a proxy server connection or return values of Kaspersky Scan Engine functions.</p>
</li></ul><p class="warningcontinue1">If you enable the debug level of logging, consider that the log messages will contain <a id="h206306" class="englishcrossreferencetemplate" href="179925.htm" target="_self">sensitive data</a>.</p>
<p class="listcontinue1">The default value is <code class="programcharacter">none</code>.</p>
</li><li class="listbullet1"><code class="programcharacter">Target</code>&#8212;The parent element for parameters that specify where logs must be written.</li><li class="listbullet1"><code class="programcharacter">File</code>&#8212;Indicates that logs are written directly to log files. It also specifies the properties of log files. <p class="listcontinue1">This element has the following attributes:</p>
<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">size_limit</code>&#8212;Specifies the maximum possible size of a log file, in megabytes (MB).<p class="listcontinue2">If the value of this attribute is <code class="programcharacter">0</code>, the log file has no size limit.</p>
<p class="listcontinue2">The default value is <code class="programcharacter">0</code>.</p>
</li><li class="listbullet2"><code class="programcharacter">folder</code>&#8212;Specifies the directory where log files are stored.<p class="listcontinue2">The path can be absolute or relative. The relative path is specified relative to the directory that holds the kavicapd executable file. </p>
<p class="listcontinue2">The default value is <code class="programcharacter">./logs</code>.</p>
</li><li class="listbullet2"><code class="programcharacter">clear_folder</code>&#8212;Specifies whether Kaspersky Scan Engine must delete old logs on initialization.<p class="listcontinue2">Kaspersky Scan Engine deletes old log files only if the value of this parameter is<code class="programcharacter"> 1</code>, <code class="programcharacter">yes</code>, <code class="programcharacter">true</code>, <code class="programcharacter">on</code>, or <code class="programcharacter">enabled</code>. If the value of this parameter is <code class="programcharacter">0</code>, <code class="programcharacter">no</code>, <code class="programcharacter">false</code>, <code class="programcharacter">off</code>, or <code class="programcharacter">disabled</code>, Kaspersky Scan Engine does not delete old log files. Notice that Kaspersky Scan Engine checks this parameter and deletes logs at the time the service starts. If the value of this parameter is set to <code class="programcharacter">1</code>, <code class="programcharacter">yes</code>, <code class="programcharacter">true</code>, <code class="programcharacter">on</code>, or <code class="programcharacter">enabled</code> when the service is already running, log files are not deleted until the service is restarted.  </p>
<p class="listcontinue2">The default value is <code class="programcharacter">0</code>.</p>
</li></ul><p class="listcontinue1">Generated log files are named as follows: icapdkav_&lt;pid&gt;_&lt;date_time&gt;_&lt;log_number&gt;.log, where &lt;pid&gt; is the PID of the process, &lt;date_time&gt; is local system date in the <code class="programcharacter">YYYY-MM-DDhhmmss</code> format, and &lt;log_number&gt; is the number of the log (this parameter is appended to the file name only if the icapdkav_&lt;pid&gt;_&lt;date_time&gt;.log log file already exists).</p>
</li></ul><p class="introheading">SyslogLogging Section</p>
<ul class="listbullet1"><li class="listbullet1"><code class="programcharacter">SyslogLogging</code> is a parent element that contains setting for logs that are redirected to <code class="programcharacter">syslogd</code>. <p class="listcontinue1">This element has the following child elements:</p>
<ul class="listbullet2"><li class="listbullet2"><code class="programcharacter">SyslogEnabled</code>&#8212;Specifies whether Kaspersky Scan Engine sends syslog messages.<p class="listcontinue2">Possible values:</p>
<ul class="listbullet3"><li class="listbullet3"><code class="programcharacter">0</code>, <code class="programcharacter">false</code>, <code class="programcharacter">no</code>, <code class="programcharacter">off</code>, or <code class="programcharacter">disabled</code><p class="listcontinue3">Disables sending of syslog messages.</p>
</li><li class="listbullet3">Any other value<p class="listcontinue3">Enables sending of syslog messages.</p>
</li></ul><p class="warningcontinue2">If you enable sending syslog messages, consider that these messages will contain sensitive data, such as personal data as defined by GDPR, configuration data of the product, and licensing information.</p>
</li><li class="listbullet2"><code class="programcharacter">Syslog</code> specifies settings related to syslog messages. <p class="listcontinue2">This element has the following attributes:</p>
<ul class="listbullet3"><li class="listbullet3"><code class="programcharacter">destination</code>&#8212;Specifies the destination for syslog messages.<p class="listcontinue3">The following destinations are possible:</p>
<ul class="listbullet4"><li class="listbullet4">IP address. In this case, specify the<code class="programcharacter"> %PROTOCOL%%IP%:%PORT% </code>value, where <code class="programcharacter">%PROTOCOL%</code> is a network protocol (use <code class="programcharacter">tcp://</code> or <code class="programcharacter">udp://</code> for this value), <code class="programcharacter">%IP%</code> is an IPv4 address that receives syslog messages, <code class="programcharacter">%PORT%</code> is a port that receives syslog messages. If you do not specify a protocol as described above, KAV SDK will use the UDP protocol.</li><li class="listbullet4">Syslog daemon. In this case, specify the <code class="programcharacter">localhost </code>value to redirect syslog messages to a syslog daemon.</li><li class="listbullet4">Log file. In this case, specify the path to the directory where the log file will be created. The path must begin with <code class="programcharacter">/var/log/kaspersky</code>. The log file with syslog messages created by previous sessions is not removed and  the ICAP plug-in appends new information to this file.</li></ul><p class="listcontinue3">If it is necessary to write logs into the different locations, you can specify several <code class="programcharacter">Syslog</code> elements. In this case, the <code class="programcharacter">destination</code> attribute values of these elements must vary.</p>
</li><li class="listbullet3"><code class="programcharacter">format</code>&#8212;Specifies the format of syslog messages.<p class="listcontinue3">Possible values:</p>
<ul class="listbullet4"><li class="listbullet4"><code class="programcharacter">cef</code>&#8212;Specifies the <a id="h193363" class="englishcrossreferencetemplate" href="186631.htm" target="_self">CEF format</a> of syslog messages.</li><li class="listbullet4"><code class="programcharacter">raw</code>&#8212;Specifies the <a id="h193364" class="englishcrossreferencetemplate" href="186652.htm" target="_self">RAW format</a> of syslog messages. The <code class="programcharacter">raw</code> value is used when the value specified in this element is not <code class="programcharacter">cef</code> or <code class="programcharacter">raw</code>, or no value is specified in this element, or if the logging configuration file does not contain the <code class="programcharacter">SyslogFormat</code> parameter.</li></ul></li></ul><p class="listcontinue2"><code class="programcharacter">Syslog</code> may have the following child element:</p>
<ul class="listbullet3"><li class="listbullet3"><code class="programcharacter">LoggedEvent</code>&#8212;Specifies events to be logged. <p class="listcontinue3">It is allowed to specify multiple <code class="programcharacter">LoggedEvent</code> values. Each of these values sets the type of event that will be logged into the location specified in the <code class="programcharacter">destination</code> attribute.</p>
<p class="listcontinue3">Possible values:</p>
<ul class="listbullet4"><li class="listbullet4"><code class="programcharacter">Audit</code>&#8212;Specifies system audit events.</li><li class="listbullet4"><code class="programcharacter">Init</code>&#8212;Specifies service initialization events. </li><li class="listbullet4"><code class="programcharacter">Deinit</code>&#8212;Specifies service deinitialization events and watchdog events. </li><li class="listbullet4"><code class="programcharacter">Update</code>&#8212;Specifies antivirus database update and reload events.</li><li class="listbullet4"><code class="programcharacter">License</code>&#8212;Specifies license-related events.</li><li class="listbullet4"><code class="programcharacter">Engine</code>&#8212;Specifies antivirus engine events.  These events may be published frequently.</li><li class="listbullet4"><code class="programcharacter">ScanResultClean</code>&#8212;Specifies scan completion events when scanned object considered clean.</li><li class="listbullet4"><code class="programcharacter">ScanResultDetect</code>&#8212;Specifies scan completion events when threat was detected.</li><li class="listbullet4"><code class="programcharacter">ScanResultOther</code>&#8212;Specifies scan completion events when object was not scanned.</li></ul><p class="listcontinue3">If the <code class="programcharacter">Syslog</code> element does not contain the <code class="programcharacter">LoggedEvent</code> child element, all the ICAP events logged. </p>
<p class="listcontinue3">If the <code class="programcharacter">Syslog</code> settings are incorrect, logging to the specified destination will be disabled.</p>
<p class="listcontinue3">When syslog logging is enabled, system audit is enabled as well. If none of the <code class="programcharacter">SyslogEvents</code> elements contains the <code class="programcharacter">Audit</code> event, system audit settings are set as follows:  <code class="programcharacter">SyslogFormat</code> is set to <code class="programcharacter">raw</code>, <code class="programcharacter">SyslogTarget</code> is set to <code class="programcharacter">localhost</code>, and <code class="programcharacter">SyslogEvents</code> is set to <code class="programcharacter">audit</code>.</p>
</li></ul></li></ul></li></ul><p class="attentionbody">Kaspersky Scan Engine can write debug logs and send syslog messages at the same time or separately.</p>
<p class="introheading">Structure of the logging configuration file</p>
<p class="bodytext">Following is an example of a logging configuration file:</p>
<table class="tableintopic" width="1131" cellpadding="2" cellspacing="0" border="0" style="border-collapse:collapse" bgcolor="#E5F1FB">
<tr align="left" valign="top">
<td bgcolor="#E5F1FB" width="1131"><p class="program">&lt;?xml version=&quot;1.0&quot;?&gt;</p>
<p class="program">&lt;Logging&gt;</p>
<p class="program2">&lt;DebugLogging&gt;</p>
<p class="program3">&lt;Level&gt;debug&lt;/Level&gt;</p>
<p class="program3">&lt;File size_limit=&quot;10&quot; folder=&quot;./logs/scanevents&quot; clear_folder=&quot;1&quot;/&gt;</p>
<p class="program2">&lt;/DebugLogging&gt;</p>
<p class="program2">&lt;SyslogLogging&gt;</p>
<p class="program3">&lt;SyslogEnabled&gt;1&lt;/SyslogEnabled&gt;</p>
<p class="program3">&lt;Syslog destination=&quot;udp://192.168.1.1&quot; format=&quot;cef&quot;&gt;</p>
<p class="program4">&lt;LoggedEvent&gt;ScanResultClean&lt;/LoggedEvent&gt;</p>
<p class="program4">&lt;LoggedEvent&gt;ScanResultDetect&lt;/LoggedEvent&gt;</p>
<p class="program3">&lt;/Syslog&gt;</p>
<p class="program3">&lt;Syslog destination=&quot;localhost&quot; format=&quot;raw&quot;&gt;</p>
<p class="program4">&lt;LoggedEvent&gt;ScanResultOther&lt;/LoggedEvent&gt;</p>
<p class="program3">&lt;/Syslog&gt;</p>
<p class="program3">&lt;Syslog destination=&quot;/opt/kav/sdk8l3/logs&quot; format=&quot;raw&quot;&gt;</p>
<p class="program4">&lt;LoggedEvent&gt;Audit&lt;/LoggedEvent&gt;</p>
<p class="program4">&lt;LoggedEvent&gt;Engine&lt;/LoggedEvent&gt;</p>
<p class="program3">&lt;/Syslog&gt;</p>
<p class="program2">&lt;/SyslogLogging&gt;</p>
<p class="program">&lt;/Logging&gt;</p>
</td>
</tr>

</table>
<p class="spacer"></p>


	<a href="#" class="bt-home">Page top</a>
	</div>
</body>

</html>
