<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="description" content=""/>
    <meta name="viewport" content="maximum-scale=1.0" />
    <title> Working with response templates and scripts </title>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-MPK6ZG');</script>
	<!-- End Google Tag Manager -->
    <script type="text/javascript" src="../langs.js"></script>
    <script type="text/javascript">
        !function ( w, d ) {
            var scriptsPath="/localization/";
            if(w.location.pathname.match(/title\.htm$/)){scriptsPath="./js/"}d.writeln("\x3Cscript type='text/javascript' src='"+scriptsPath+d.documentElement.lang+".js'>\x3C/script>");
        }( window, document );
    </script>	
    <script type="text/javascript" src="toc.js"></script>
    
    <script type="text/javascript" src="aiconverter_result.js"></script>
    <link rel="stylesheet" type='text/css' href="typography.css"/>
    <link rel="stylesheet" type='text/css' href="styles.css"/>
    <link rel="shortcut icon" href="favicon.ico"/>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
    <link rel="icon" href="favicon.png" type="image/png"/>

            <!--[if lte IE 9]>
                <link rel="stylesheet" type="text/css" href="bootstrap.css">
            <![endif]-->
            <!--[if lte IE 8]>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"></script>
            <![endif]-->
            </head>

<body id="who-content" class="no-js">
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MPK6ZG" style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->
	<noscript class="no-js__message">
	<a href="https://support.microsoft.com/en-us/kb/3135465" class="no-js__link">Please enable JavaScript in your browser!</a>
	</noscript>
	<div class="cont">
	<h3 id="t234596" class="heading3">Working with response templates and scripts</h3>
<p class="bodytext">Rules allow you to specify response templates that can be returned in place of blocked web pages, and to specify scripts that can be executed upon detection, for example, to notify the system administrator. </p>
<p class="bodytext">The Kaspersky Scan Engine distribution package contains sample response templates and a sample script that sends information about an incident to <code class="programcharacter">syslog</code>.</p>
<p class="introheading">Working with response templates</p>
<p class="bodytext">Kaspersky Scan Engine is shipped with the following sample response templates located in the <code class="programcharacter">/opt/kaspersky/ScanEngine/icap_data/templates</code> directory: </p>
<ul class="listbullet1"><li class="listbullet1"><code class="programcharacter">detect_req</code> <p class="listcontinue1">This template is returned when a threat or a type of legitimate software that can be used by intruders to damage a user's computer or personal data is detected in request modification (REQMOD) mode. </p>
</li><li class="listbullet1"><code class="programcharacter">detect_res</code> <p class="listcontinue1">This template is returned when a threat or a type of legitimate software that can be used by intruders to damage a user's computer or personal data is detected in response modification (RESPMOD) mode.</p>
</li><li class="listbullet1"><code class="programcharacter">macro_req</code><p class="listcontinue1">This template is returned when a Microsoft Office document file that contains a macro is detected in the request modification (REQMOD) mode.</p>
</li><li class="listbullet1"><code class="programcharacter">macro_resp</code><p class="listcontinue1">This template is returned when a Microsoft Office document file that contains a macro is detected in the response modification (RESPMOD) mode.</p>
</li></ul><p class="bodytext">You can create custom response templates and <a id="h180152" class="englishcrossreferencetemplate" href="179893.htm" target="_self">configure Kaspersky Scan Engine to return them with the modified message</a>. Like sample response templates, custom response templates can use a detection context that provides additional information to a user. For more information on the detection context, see subsection &quot;Using the detection context in response templates and scripts&quot; below.</p>
<p class="attentionbody">Even though Kaspersky Scan Engine returns response templates in place of blocked web pages, some browsers may not display these templates, returning a <code class="programcharacter">403</code> <code class="programcharacter">Forbidden</code> HTTP status code instead.</p>
<p class="introheading">Working with scripts</p>
<p class="bodytext">Kaspersky Scan Engine is shipped with a <code class="programcharacter">send_syslog</code> script located in the /opt/kaspersky/ScanEngine/icap_data/scripts directory.</p>
<p class="bodytext">The <code class="programcharacter">send_syslog</code> script displays a message about a detected object and redirects the message to <code class="programcharacter">logger</code>. </p>
<p class="bodytext">You can create custom shell scripts and <a id="h180152_2" class="englishcrossreferencetemplate" href="179893.htm" target="_self">configure Kaspersky Scan Engine to execute them upon detection</a>. Like the sample script, custom scripts can use the detection context that provides additional information to a user. For more information on the detection context, see subsection &quot;Using the detection context in response templates and scripts&quot; below.</p>
<p class="bodytext">Custom scripts run in parallel threads. The maximum number of these threads is 100.</p>
<p class="introheading">Using the detection context in response templates and scripts</p>
<p class="bodytext">Response templates and scripts support the detection context. When a response template is displayed, context variables are replaced with values returned by Kaspersky Scan Engine. To use the detection context in a script, reference context variables as environment variables.</p>
<p class="bodytext">The following variables are supported in the detection context:</p>
<ul class="listbullet1"><li class="listbullet1"><code class="programcharacter">_VirusName_</code>&#8212;Name of the detected object.</li><li class="listbullet1"><code class="programcharacter">_DateTime_</code>&#8212;Date and time of the incident (in the <code class="programcharacter">YYYY-MM-DD HH:MM:MS</code> format).</li><li class="listbullet1"><code class="programcharacter">_ICAPDVersion_</code>&#8212;Version of the ICAP plug-in. </li><li class="listbullet1"><code class="programcharacter">_URL_</code>&#8212;Requested URL.</li></ul><p class="bodytext">You can use the detection context in custom response templates and scripts.</p>


	<a href="#" class="bt-home">Page top</a>
	</div>
</body>

</html>
